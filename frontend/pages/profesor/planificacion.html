<!DOCTYPE html>
<html lang="es" class="h-full">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Planificación - SpeakLexi</title>
    
    <!-- ✅ PRELOAD CRÍTICO -->
    <link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" as="style">
    <link rel="preload" href="/assets/css/custom-styles.css" as="style">
    
    <!-- ✅ CSS EXTERNO -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- ✅ TAILWIND CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        // Configuración inline de Tailwind
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        primary: {
                            50: '#f0f9ff',
                            100: '#e0f2fe',
                            200: '#bae6fd',
                            300: '#7dd3fc',
                            400: '#38bdf8',
                            500: '#0ea5e9',
                            600: '#0284c7',
                            700: '#0369a1',
                            800: '#075985',
                            900: '#0c4a6e',
                        },
                        secondary: {
                            50: '#faf5ff',
                            100: '#f3e8ff',
                            200: '#e9d5ff',
                            300: '#d8b4fe',
                            400: '#c084fc',
                            500: '#a855f7',
                            600: '#9333ea',
                            700: '#7e22ce',
                            800: '#6b21a8',
                            900: '#581c87',
                        }
                    }
                }
            }
        }
    </script>
    
    <!-- ✅ CSS INTERNO -->
    <link rel="stylesheet" href="/assets/css/custom-styles.css">
    <link rel="stylesheet" href="/assets/css/animations.css">
    
    <!-- ✅ CHART.JS -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- ✅ META OPTIMIZACIÓN -->
    <meta name="description" content="SpeakLexi - Planificación de Contenidos">
    <meta name="theme-color" content="#4F46E5">
</head>
<body class="h-full bg-gray-50 dark:bg-gray-900 transition-colors duration-300">
    <!-- ✅ NAVBAR DINÁMICO -->
    <div id="navbar-container"></div>
    
    <!-- ✅ CONTENIDO PRINCIPAL -->
    <main class="min-h-screen pt-16">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
            <!-- Header -->
            <div class="mb-8">
                <h2 class="text-3xl font-bold text-gray-900 dark:text-white mb-2">Planificación de Contenidos</h2>
                <p class="text-gray-600 dark:text-gray-300">Crea y gestiona planes de estudio personalizados para tus estudiantes</p>
                
                <!-- Breadcrumb -->
                <div class="flex items-center gap-2 mt-4 text-sm text-gray-500 dark:text-gray-400">
                    <a href="/pages/profesor/dashboard.html" class="hover:text-primary-600">Profesor</a>
                    <i class="fas fa-chevron-right text-xs"></i>
                    <span class="text-primary-600 dark:text-primary-400">Planificación</span>
                </div>
            </div>

            <!-- Dashboard de Análisis -->
            <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-6 border border-gray-100 dark:border-gray-700 mb-8">
                <div class="flex items-center justify-between mb-6">
                    <h3 class="text-xl font-bold text-gray-900 dark:text-white">Análisis del Grupo</h3>
                    <button class="text-sm text-primary-600 dark:text-primary-400 hover:underline font-semibold">
                        <i class="fas fa-sync-alt mr-1"></i>Actualizar análisis
                    </button>
                </div>

                <!-- Loading Indicator -->
                <div id="loading-dashboard" class="hidden flex items-center justify-center py-8">
                    <div class="text-center">
                        <div class="w-12 h-12 border-4 border-primary-200 border-t-primary-600 rounded-full animate-spin mx-auto mb-4"></div>
                        <p class="text-gray-600 dark:text-gray-400">Analizando desempeño del grupo...</p>
                    </div>
                </div>

                <!-- Estadísticas Generales -->
                <div id="analisis-grupo" class="mb-8">
                    <!-- Se llenará dinámicamente -->
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                    <!-- Áreas Críticas -->
                    <div>
                        <h4 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">Áreas que Necesitan Atención</h4>
                        <div id="areas-criticas" class="space-y-4">
                            <!-- Se llenará dinámicamente -->
                        </div>
                    </div>

                    <!-- Gráfico de Desempeño -->
                    <div>
                        <h4 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">Desempeño por Habilidad</h4>
                        <div class="h-80">
                            <canvas id="grafico-desempeno"></canvas>
                        </div>
                    </div>
                </div>

                <!-- Sugerencias Automáticas -->
                <div class="mt-8">
                    <h4 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">Sugerencias de Contenido</h4>
                    <div id="sugerencias" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <!-- Se llenará dinámicamente -->
                    </div>
                </div>
            </div>

            <!-- Sección de Planes de Contenido -->
            <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-6 border border-gray-100 dark:border-gray-700">
                <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between mb-6">
                    <h3 class="text-xl font-bold text-gray-900 dark:text-white mb-4 sm:mb-0">Planes de Contenido</h3>
                    <button id="btn-crear-plan" class="px-4 py-2 bg-primary-600 hover:bg-primary-700 text-white rounded-lg font-medium transition-colors flex items-center gap-2">
                        <i class="fas fa-plus"></i>
                        Crear Nuevo Plan
                    </button>
                </div>

                <!-- Loading Indicator -->
                <div id="loading-planes" class="hidden flex items-center justify-center py-8">
                    <div class="text-center">
                        <div class="w-12 h-12 border-4 border-primary-200 border-t-primary-600 rounded-full animate-spin mx-auto mb-4"></div>
                        <p class="text-gray-600 dark:text-gray-400">Cargando planes...</p>
                    </div>
                </div>

                <!-- Estado Vacío -->
                <div id="estado-vacio-planes" class="hidden text-center py-12">
                    <div class="w-24 h-24 bg-gray-100 dark:bg-gray-700 rounded-full flex items-center justify-center mx-auto mb-4">
                        <i class="fas fa-calendar-plus text-gray-400 text-2xl"></i>
                    </div>
                    <h4 class="text-lg font-semibold text-gray-900 dark:text-white mb-2">No hay planes creados</h4>
                    <p class="text-gray-600 dark:text-gray-400 mb-6">Comienza creando tu primer plan de contenido personalizado</p>
                    <button id="btn-crear-primer-plan" class="px-6 py-3 bg-primary-600 hover:bg-primary-700 text-white rounded-lg font-medium transition-colors">
                        Crear Mi Primer Plan
                    </button>
                </div>

                <!-- Lista de Planes -->
                <div id="lista-planes" class="space-y-4">
                    <!-- Se llenará dinámicamente -->
                </div>
            </div>
        </div>
    </main>

    <!-- Modal para Crear/Editar Plan -->
    <div id="modal-plan" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
        <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-xl w-full max-w-2xl max-h-[90vh] overflow-y-auto">
            <div class="p-6 border-b border-gray-200 dark:border-gray-700">
                <h3 class="text-xl font-bold text-gray-900 dark:text-white" id="modal-titulo">Crear Nuevo Plan</h3>
            </div>
            
            <form id="form-plan" class="p-6 space-y-6">
                <!-- Título -->
                <div>
                    <label for="input-titulo" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                        Título del Plan *
                    </label>
                    <input type="text" id="input-titulo" name="titulo" required
                           class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-primary-500 focus:border-primary-500"
                           placeholder="Ej: Plan de Refuerzo B1 - Noviembre">
                </div>

                <!-- Descripción -->
                <div>
                    <label for="textarea-descripcion" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                        Descripción *
                    </label>
                    <textarea id="textarea-descripcion" name="descripcion" rows="3" required
                              class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-primary-500 focus:border-primary-500"
                              placeholder="Describe los objetivos y enfoque de este plan..."></textarea>
                </div>

                <!-- Nivel e Idioma -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label for="select-nivel" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                            Nivel CEFR *
                        </label>
                        <select id="select-nivel" name="nivel" required
                                class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-primary-500 focus:border-primary-500">
                            <option value="">Selecciona un nivel</option>
                            <option value="A1">A1 - Principiante</option>
                            <option value="A2">A2 - Básico</option>
                            <option value="B1">B1 - Intermedio</option>
                            <option value="B2">B2 - Intermedio Alto</option>
                            <option value="C1">C1 - Avanzado</option>
                            <option value="C2">C2 - Maestría</option>
                        </select>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                            Idioma
                        </label>
                        <div class="px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-gray-50 dark:bg-gray-700 text-gray-600 dark:text-gray-400">
                            Inglés
                        </div>
                        <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">Actualmente solo disponible en inglés</p>
                    </div>
                </div>

                <!-- Áreas de Enfoque -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-3">
                        Áreas de Enfoque *
                    </label>
                    <div class="grid grid-cols-2 md:grid-cols-3 gap-3">
                        <label class="flex items-center space-x-2 p-3 border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 cursor-pointer">
                            <input type="checkbox" name="areas_enfoque" value="lectura" class="text-primary-600 focus:ring-primary-500">
                            <span class="text-sm text-gray-700 dark:text-gray-300">Lectura</span>
                        </label>
                        <label class="flex items-center space-x-2 p-3 border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 cursor-pointer">
                            <input type="checkbox" name="areas_enfoque" value="escritura" class="text-primary-600 focus:ring-primary-500">
                            <span class="text-sm text-gray-700 dark:text-gray-300">Escritura</span>
                        </label>
                        <label class="flex items-center space-x-2 p-3 border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 cursor-pointer">
                            <input type="checkbox" name="areas_enfoque" value="escucha" class="text-primary-600 focus:ring-primary-500">
                            <span class="text-sm text-gray-700 dark:text-gray-300">Escucha</span>
                        </label>
                        <label class="flex items-center space-x-2 p-3 border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 cursor-pointer">
                            <input type="checkbox" name="areas_enfoque" value="habla" class="text-primary-600 focus:ring-primary-500">
                            <span class="text-sm text-gray-700 dark:text-gray-300">Habla</span>
                        </label>
                        <label class="flex items-center space-x-2 p-3 border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 cursor-pointer">
                            <input type="checkbox" name="areas_enfoque" value="gramatica" class="text-primary-600 focus:ring-primary-500">
                            <span class="text-sm text-gray-700 dark:text-gray-300">Gramática</span>
                        </label>
                        <label class="flex items-center space-x-2 p-3 border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 cursor-pointer">
                            <input type="checkbox" name="areas_enfoque" value="vocabulario" class="text-primary-600 focus:ring-primary-500">
                            <span class="text-sm text-gray-700 dark:text-gray-300">Vocabulario</span>
                        </label>
                    </div>
                </div>

                <!-- Fechas -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label for="input-fecha-inicio" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                            Fecha de Inicio *
                        </label>
                        <input type="date" id="input-fecha-inicio" name="fecha_inicio" required
                               class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-primary-500 focus:border-primary-500">
                    </div>

                    <div>
                        <label for="input-fecha-fin" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                            Fecha de Fin *
                        </label>
                        <input type="date" id="input-fecha-fin" name="fecha_fin" required
                               class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-primary-500 focus:border-primary-500">
                    </div>
                </div>

                <!-- Objetivos Sugeridos -->
                <div class="bg-blue-50 dark:bg-blue-900/20 rounded-lg p-4">
                    <h4 class="font-semibold text-blue-800 dark:text-blue-300 mb-2">Objetivos Sugeridos</h4>
                    <ul class="text-sm text-blue-700 dark:text-blue-400 space-y-1">
                        <li class="flex items-center gap-2">
                            <i class="fas fa-check text-xs"></i>
                            Mejorar habilidades identificadas en el análisis
                        </li>
                        <li class="flex items-center gap-2">
                            <i class="fas fa-check text-xs"></i>
                            Incrementar tasa de completación
                        </li>
                    </ul>
                </div>
            </form>

            <div class="flex justify-end gap-3 p-6 border-t border-gray-200 dark:border-gray-700">
                <button id="btn-cancelar-plan" type="button"
                        class="px-4 py-2 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors">
                    Cancelar
                </button>
                <button id="btn-guardar-plan" type="submit" form="form-plan"
                        class="px-6 py-2 bg-primary-600 hover:bg-primary-700 text-white rounded-lg font-medium transition-colors">
                    Crear Plan
                </button>
            </div>
        </div>
    </div>

    <!-- Modal de Confirmación -->
    <div id="modal-confirmacion" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
        <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-xl w-full max-w-md">
            <div class="p-6 border-b border-gray-200 dark:border-gray-700">
                <h3 class="text-lg font-semibold text-gray-900 dark:text-white">Confirmar Acción</h3>
            </div>
            
            <div class="p-6">
                <p id="texto-confirmacion" class="text-gray-700 dark:text-gray-300 mb-6">
                    ¿Estás seguro de que quieres realizar esta acción?
                </p>
                
                <div class="flex justify-end gap-3">
                    <button id="btn-confirmar-no" type="button"
                            class="px-4 py-2 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors">
                        Cancelar
                    </button>
                    <button id="btn-confirmar-si" type="button"
                            class="px-6 py-2 bg-red-600 hover:bg-red-700 text-white rounded-lg font-medium transition-colors">
                        Confirmar
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- ============================================
         ORDEN DE CARGA CORREGIDO
    ============================================ -->
    
    <!-- 1️⃣ CONFIGURACIÓN GLOBAL -->
    <script src="/config/app-config.js"></script>
    
    <!-- 2️⃣ CORE MODULES -->
    <script src="/assets/js/core/utils.js"></script>
    <script src="/assets/js/core/api-client.js"></script>
    <script src="/assets/js/core/form-validator.js"></script>
    <script src="/assets/js/core/toast-manager.js"></script>
    <script src="/assets/js/core/theme-manager.js"></script>
    <script src="/assets/js/core/module-loader.js"></script>
    
    <!-- 3️⃣ MÓDULOS ADICIONALES -->
    <script src="/assets/js/core/navbar-loader.js"></script>
    
    <!-- 4️⃣ LÓGICA DE PÁGINA (al final) -->
    <script src="/assets/js/pages/profesor/planificacion.js"></script>
    <!-- Sistema de notificaciones y mensajes -->
    <script src="/assets/js/core/notificaciones-manager.js"></script>

</body>
</html>